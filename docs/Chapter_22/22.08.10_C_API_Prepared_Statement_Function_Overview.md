## 22.8.10. C API预处理语句函数概述

本节对预处理语句处理相关的函数进行归纳，下一节会将详细进行描述。请参考 [22.8.11，C API预处理语句函数描述]() 。

<table>
	<tr><th>函数()</th><th>描述</th></tr>
	<tr><td>mysql_stmt_affected_rows()</td><td>返回预处理的UPDATE，DELETE或者INSERT语句修改，删除或者插入的记录的数目</td></tr>
	<tr><td>mysql_stmt_attr_get()</td><td>获取预处理语句的某特定属性的值</td></tr>
	<tr><td>mysql_stmt_attr_set()</td><td>设置预处理语句的某特定属性的值</td></tr>
	<tr><td>mysql_stmt_bind_param()</td><td>关联预处理SQL语句中的参数标记和应用程序数据缓冲区</td></tr>
	<tr><td>mysql_stmt_bind_param()</td><td>关联结果集字段和应用程序数据缓冲区</td></tr>
	<tr><td>mysql_stmt_close()</td><td>释放预处理语句使用的内存</td></tr>
	<tr><td>mysql_stmt_data_seek()</td><td>定位到结果集中的任意行</td></tr>
	<tr><td>mysql_stmt_errno()</td><td>返回最后一条语句执行产生的错误码</td></tr>
	<tr><td>mysql_stmt_error()</td><td>返回最后一条语句执行产生的错误消息</td></tr>
	<tr><td>mysql_stmt_execute()</td><td>执行预处理语句</td></tr>
	<tr><td>mysql_stmt_fetch()</td><td>获取结果集中的下一条记录并且返回所有绑定字段的数据</td></tr>
	<tr><td>mysql_stmt_fetch_column()</td><td>获取结果集中当前行某一字段的数据</td></tr>
	<tr><td>mysql_stmt_field_count()</td><td>返回最近一条语句生成的结果集的字段数</td></tr>
	<tr><td>mysql_stmt_free_result()</td><td>释放分配给语句句柄的资源</td></tr>
	<tr><td>mysql_stmt_init()</td><td>为MYSQL_STMT结构分配内存并将其初始化</td></tr>
	<tr><td>mysql_stmt_insert_id()</td><td>返回预处理语句为AUTO_INCREMENT字段生成的ID</td></tr>
	<tr><td>mysql_stmt_next_result()</td><td>返回多结果集执行所生成的下一结果集</td></tr>
	<tr><td>mysql_stmt_num_rows()</td><td>返回已缓存结果集的记录数</td></tr>
	<tr><td>mysql_stmt_param_count()</td><td>返回预处理语句中的参数数目</td></tr>
	<tr><td>mysql_stmt_param_metadata()</td><td>（以结果集的方式返回参数相关元数据）目前该函数尚未生效</td></tr>
	<tr><td>mysql_stmt_prepare()</td><td>预处理一条SQL语句以备执行</td></tr>
	<tr><td>mysql_stmt_reset()</td><td>重置服务端的语句缓存</td></tr>
	<tr><td>mysql_stmt_result_metadata()</td><td>以结果集的方式返回预处理语句相关元数据</td></tr>
	<tr><td>mysql_stmt_row_seek()</td><td>以由mysql_stmt_row_tell()返回的值为参数定位到结果集中的某行</td></tr>
	<tr><td>mysql_stmt_row_tell()</td><td>返回当前的行游标位置</td></tr>
	<tr><td>mysql_stmt_send_long_data()</td><td>以块为单位向服务端发送长数据</td></tr>
	<tr><td>mysql_stmt_sqlstate()</td><td>返回最近一条语句执行产生的SQLSTATE错误码</td></tr>
	<tr><td>mysql_stmt_store_result()</td><td>读取完整的结果集到客户端</td></tr>
</table>

首先调用 *mysql_stmt_init()* 创建语句句柄，然后调用 *mysql_stmt_prepare()* 预处理语句字符串，然后在调用 *mysql_stmt_bind_param()* 以提供参数，最后调用 *mysql_stmt_execute()* 以执行语句。可以通过更改由 *mysql_stmt_bind_param()* 提供的各个缓冲区中的参数值来重复多次调用 *mysql_stmt_execute()* 。

可以调用 *mysql_stmt_send_long_data()* 来向服务端以块的方式发送文本或者二进制数据。参考 [22.8.11.26，mysql_stmt_send_long_data()]() 。

调用 *mysql_stmt_bind_param()* 可以指定结果集缓冲区，从而 *mysql_stmt_fetch()* 可以自动将数据返回到这些缓冲区。这是一种逐行读取的方式。

当语句执行完成时，调用 *mysql_stmt_close()* 以关闭语句句柄，从而释放所有关联的资源。

如果通过调用 *mysql_stmt_result_metadata()* 的方式获取了 **SELECT** 语句的结果集元数据，必须调用 *mysql_free_result()* 以释放元数据。