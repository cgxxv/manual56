## 22.8.7. C API函数描述
在本节中，参数或者返回值为NULL，是指其意义为C语言中的NULL，而不是MySQL中的NULL值。

有返回值的函数通常是返回一个指针类型值或者整型值。除非特别说明，返回值为指针类型的的函数如果返回了非NULL值则表示调用成功，返回NULL值表示失败，返回值为整型的函数返回0表示成功，返回非0表示失败。注意所谓非0就是指除0外的所有值，所以除非特别说明，不要以非0值来检查返回值。

```c
if (result)                   /* correct */
    ... error ...

if (result < 0)               /* incorrect */
    ... error ...

if (result == -1)             /* incorrect */
    ... error ...
```

当一个函数返回返回了错误，函数描述的错误子节会列出可能的错误类型。通过调用 *mysql_errno()* 来确定是哪一种错误。也可以调用 *mysql_error()* 来获取字符串形式的错误信息。

**22.8.7.1.**  *mysql_affected_rows()*

_my_ulonglong mysql_affected_rows(MYSQL *mysql)_

**描述**

*mysql_affected_rows()* 可以在调用 *mysql_query()* 或者 *mysql_real_query()* 执行一个语句之后立即被调用。如果上一个语句是 **UPDATE** ， **DELETE** 或者 **INSERT** ,该调用会返回相应的被修改，删除或者插入的行数。对于 **SELECT** 语句，该调用的作用跟 *mysql_num_rows()* 一样。
 
对于 **UPDATE** 语句，被影响行数默认是指事实被修改的行数。如果在以 *mysql_real_connect()* 调用连接 *mysqld* 时，如果设置了 **CLIENT_FOUND_ROWS** 标记，则被影响行数则是指“发现”的行数，也就是匹配 **WHERE** 从句的行数。
 
对于 **REPLACE** 语句，如果是一个新行替换了一条旧行，则受影响行数为2，因为在此情况下是先删除旧行再插入新行。
 
对于 **INSERT ... ON DUPLICATE KEY UPDATE** 语句，如果是插入了新行则受影响行数1，如果是更新已有行则受影响行数是2，如果对某行更新的目标值和当前值一样则受影响行数是0，但是如果此时设置了 **CLIENT_FOUND_ROWS** 标记，那么受影响行数这个值就为1了。
 
在使用 **CALLL** 语句调用了一个存储过程之后，该函数的返回值反映的是存储过程中最后一条语句的影响的行数，要是那条语句执行失败则其值为0。在存储过程内部，你可以调用SQL层面的 **ROW_COUNT()** 来获取每一单条语句的影响行数。
 
在MySQL 5.6中，该函数可以为更广泛的语句返回有意义的值。详细请参考 [12.14，信息函数]() 中对 **ROW_COUNT()** 的描述。
 
**返回值**

大于0的整数则表示受影响或者返回的行数。0表示没有记录被修改，或者 **WHERE** 未被匹配或者根本没有执行任何查询。-1表示该函数出错了，或者是因为对于 **SELECT** 语句，在调用 *mysql_store_result()* 之前调用了 *mysql_affected_rows()* 。

因为 *mysql_affected_rows()* 返回是无符号整数，通过将返回值与 *(my_ulonglong)-1* 或者 *(my_ulonglong)~0* 比较来确定是否返回了-1。

**错误**

无

**范例**

```c
char *stmt = "UPDATE products SET cost=cost*1.25
              WHERE group=10";
mysql_query(&mysql,stmt);
printf("%ld products updated",
       (long) mysql_affected_rows(&mysql));
```