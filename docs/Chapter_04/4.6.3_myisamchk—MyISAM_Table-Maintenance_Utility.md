### 4.6.3 myisamchk — MyISAM表维护程序

#### 4.6.3.1 [myisamchk 通用选项](#4.6.3.1)
#### 4.6.3.2 [myisamchk Check 选项](#4.6.3.2)
#### 4.6.3.3 [myisamchk Repair 选项](#4.6.3.3)
#### 4.6.3.4 [myisamchk 其它选项](#4.6.3.4)
#### 4.6.3.5 [使用 myisamchk 获取表信息](#4.6.3.5)
#### 4.6.3.6 [myisamchk 内存使用问题](#4.6.3.6)


[myisamchk](#) 程序用来获取数据库表信息，或者是检查、修复、优化数据库表. [myisamchk](#) 用于存储引擎为 MyISAM 类型的表(即具有存储数据的.MYD和存储索引的.MYI的表)。

也可以使用 [CHECK TABLE][13.7.2] 和 [REPARE TABLE][13.7.2] 语句来检查和修复MyISAM表。 参见 [13.7.2.2, CHECK TABLE 语法][13.7.2] 和 [13.7.2.5, REPAIR TABLE 语法][13.7.2].

[myisamchk** 不支持分区表

>注意:
>在执行表修复之前最好做表备份，因为在某种条件下，可能造成数据丢失，产生的原因可能是文件系统错误也可能是其它的原因。

[myisamchk](#) 调用如下：

```shell
shell> myisamchk [options] tbl_name ...
```
选项 *options* 指明了想用 [myisamchk](#) 来做什么，本节接下来将详细介绍。可以使用 [myisamchk --help](#) 查看所有的选项。

如果没有指定选项，则 [myisamchk](#) 以默认选项检测表。如果想获取更多的信息或者是让 [mtisamchk](#) 执行纠正操作，则需要指明相应的选项，接下来将具体介绍。

*tbl_name* 是需要检查或者修复的数据库表名称。如果不是在数据所在目录调用 [myisamchk](#) 程序，则需要显示指定数据所在目录，因为 [myisamchk](#) 不知道数据所在的目录。实际上， [myisamchk](#) 并不关心数据所在位置，你可以把表所对应的文件复制到其它目录，然后使用这些文件执行数据恢复操作。

在调用 [myisamchk](#) 的时候，可以指定多个表名，也可以指定索引文件名（以.MYI结尾的文件)代替表名,通过模式 *.MYI 可以指定目录下的所有表。例如，当前目录是数据库数据所在目录，可以检查该目录下所有的 MyISAM 表，命令如下：

```shell
shell> myisamchk *.MYI
```

如果当前目录不是数据所在目录，则需要通过指定路径名来检查所有的表：

```shell
shell> myisamchk /path/to/database_dir/*.MYI
```
甚至可以检查数据库里所有的表，通过指定一个数据路径的通配符：

```shell
shell> myisamchk /path/to/datadir/*/*.MYI
```

推荐的检查所有 MyISAM 表的方式是：

```shell
shell> myisamchk --silent --fast /path/to/datadir/*/*.MYI
```

如果想检查所有的 MyISAM 表并且修复任何出现损坏的，可以使用如下的命令：

```shell
shell> myisamchk --silent --force --fast --update-state \
          --key_buffer_size=64M --myisam_sort_buffer_size=64M \
          --read_buffer_size=1M --write_buffer_size=1M \
          /path/to/datadir/*/*.MYI
```
这个命令假设你有超过64M的内存空间，更多关于 [myisamchk](#) 内存分配的问题，参见 [4.6.3.6 myisamchk 内存使用问题](#4.6.3.6)

更多关于 [myisamchk](#) 的信息，参见 [7.6 MyISAM 表维护和Crash Recovery][7.6]

>**特别注意**
>当运行 [myisamchk](#) 的时候必须确保没有其它的程序使用该表，最安全的方式是在调用 [myisamchk](#) 的时候关闭掉MySQL服务器或者是对所有 [myisamchk](#) 用到的表加锁。
>否则，当调用 [myisamchk](#) 的时候，可能会显示如下的错误信息
>```
>warning: clients are using or haven't closed the table properly
>```
>这意味着你正在检查一个已经被其它程序更新的表（如 [mysqld][4.3.1] 服务器),但是还没有关闭数据文件或者是程序意外die掉了但没有关闭文件，结果可能会导致一个或多个 MyISAM 表数据损坏。
>如果 [mysqld][4.3.1] 正在运行，则需要执行 [FLUSH TABLES][13.7.6] 来强制服务器 flush 任何仍缓存在内存的对表的修改操作，然后需要确保之后没有人再使用这些表当调用 [myisamchk](#) 的时候。
>然而，避免这个问题最简单的方法是使用 [CHECK TABLE][13.7.2] 来代替 [myisamchk](#) ,参见 [13.7.2.2 CHECK TABLE 语法][13.7.2]


 [myisamchk](#) 支持如下的这些选项，可以在命令行中指定它们或者是在配置文件中以 [myisamchk] 选项组的形式指定。[myisamchk](#) 也支持处理选项文件的选项，参见[4.2.3.4 影响配置文件处理的命令下选项][4.2.3]

Table 4.11. myisamchk Options

<table summary="myisamchk Options" border="1">
	<colgroup>
		<col class="format">
		<col class="config_file">
		<col class="description">
		<col class="introduced">
		<col class="deprecated">
	</colgroup>
	<thead>
		<tr>
			<th scope="col">Format</th>
			<th scope="col">Option File</th>
			<th scope="col">Description</th>
			<th scope="col">Introduced</th>
			<th scope="col">Deprecated</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td scope="row">[--analyze][4.6.3.4]</td>
			<td><a class="link"
				href="">analyze</a></td>
			<td>分析索引值的分布</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_backup">--backup</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_backup">backup</a></td>
			<td>以 file_name-time.BAK 为文件名备份 .MYD 文件</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_block-search">--block-search=offset</a></td>
			<td><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_block-search">block-search</a></td>
			<td>在block给定的偏移量找到记录(record)</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_check">--check</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_check">check</a></td>
			<td>检查表是否有错误</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_check-only-changed">--check-only-changed</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_check-only-changed">check-only-changed</a></td>
			<td>仅检查上次检查后发生变更的表</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_correct-checksum">--correct-checksum</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_correct-checksum">correct-checksum</a></td>
			<td>修正表校验和信息</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_data-file-length">--data-file-length=len</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_data-file-length">data-file-length</a></td>
			<td>数据文件的最大长度 (当文件已达到最大长度需要重新创建文件)</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-general-options.html#option_myisamchk_debug">--debug[=debug_options]</a></td>
			<td><a class="link"
				href="myisamchk-general-options.html#option_myisamchk_debug">debug</a></td>
			<td>写debug日志</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">decode_bits=#</td>
			<td>decode_bits</td>
			<td>Decode_bits</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_description">--description</a></td>
			<td><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_description">description</a></td>
			<td>输出表的描述信息</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_extend-check">--extend-check</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_extend-check">extend-check</a></td>
			<td>执行表深度检查或修复并根据数据文件尽可能修复每一行</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_fast">--fast</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_fast">fast</a></td>
			<td>仅产检还没有恰当关闭的表</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_force">--force</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_force">force</a></td>
			<td>在表中发现任何错误，自动执行修复操作</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">--force</td>
			<td>force-recover</td>
			<td>重写old临时文件. 需要与 -r or -o 选项一起使用</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">ft_max_word_len=#</td>
			<td>ft_max_word_len</td>
			<td>全文索引的最大分词长度</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">ft_min_word_len=#</td>
			<td>ft_min_word_len</td>
			<td>全文索引最小分词长度</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">ft_stopword_file=value</td>
			<td>ft_stopword_file</td>
			<td>使用这个文件的 stopwords ，不使用内置的 stopwords 列表</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-general-options.html#option_myisamchk_HELP">--HELP</a></td>
			<td>&nbsp;</td>
			<td>显示帮助信息后退出</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-general-options.html#option_myisamchk_help">--help</a></td>
			<td>&nbsp;</td>
			<td>显示帮助信息后退出</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_information">--information</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_information">information</a></td>
			<td>打印被检查表的统计信息</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">key_buffer_size=#</td>
			<td>key_buffer_size</td>
			<td>MyISAM 表索引块的 buffer 的大小</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_keys-used">--keys-used=val</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_keys-used">keys-used</a></td>
			<td>位值表明更新哪个索引</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_max-record-length">--max-record-length=len</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_max-record-length">max-record-length</a></td>
			<td>如果record的长度超过了给定的长度使 myisamchk 不能分配足够的内存，则滤过此行跳到下一行</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_medium-check">--medium-check</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_medium-check">medium-check</a></td>
			<td>比 --extend-check check更快的一个检查表操作</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">myisam_block_size=#</td>
			<td>myisam_block_size</td>
			<td>索引页的block大小</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">myisam_sort_buffer_size=#</td>
			<td>myisam_sort_buffer_size</td>
			<td>buffer的大小，当执行REPAIR操作排序索引或者使用 CREATE INDEX 或 ALTER TABLE 创建索引</td>
			<td>5.6.9</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_parallel-recover">--parallel-recover</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_parallel-recover">parallel-recover</a></td>
			<td>Uses the same technique as -r and -n, but creates all the
				keys in parallel, using different threads (beta)</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_quick">--quick</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_quick">quick</a></td>
			<td>Achieve a faster repair by not modifying the data file.</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">read_buffer_size=#</td>
			<td>read_buffer_size</td>
			<td>Each thread that does a sequential scan allocates a buffer
				of this size for each table it scans</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_read-only">--read-only</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_read-only">read-only</a></td>
			<td>Don't mark the table as checked</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_recover">--recover</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_recover">recover</a></td>
			<td>Do a repair that can fix almost any problem except unique
				keys that aren't unique</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_safe-recover">--safe-recover</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_safe-recover">safe-recover</a></td>
			<td>Do a repair using an old recovery method that reads through
				all rows in order and updates all index trees based on the rows
				found</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_set-auto-increment">--set-auto-increment[=value]</a></td>
			<td><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_set-auto-increment">set-auto-increment</a></td>
			<td>Force AUTO_INCREMENT numbering for new records to start at
				the given value</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_set-collation">--set-collation=name</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_set-collation">set-collation</a></td>
			<td>Specify the collation to use for sorting table indexes</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-general-options.html#option_myisamchk_silent">--silent</a></td>
			<td><a class="link"
				href="myisamchk-general-options.html#option_myisamchk_silent">silent</a></td>
			<td>Silent mode</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">sort_buffer_size=#</td>
			<td>sort_buffer_size</td>
			<td>The buffer that is allocated when sorting the index when
				doing a REPAIR or when creating indexes with CREATE INDEX or ALTER
				TABLE</td>
			<td>&nbsp;</td>
			<td>5.6.9</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_sort-index">--sort-index</a></td>
			<td><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_sort-index">sort-index</a></td>
			<td>Sort the index tree blocks in high-low order</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">sort_key_blocks=#</td>
			<td>sort_key_blocks</td>
			<td>sort_key_blocks</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_sort-records">--sort-records=#</a></td>
			<td><a class="link"
				href="myisamchk-other-options.html#option_myisamchk_sort-records">sort-records</a></td>
			<td>根据索引排序</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_sort-recover">--sort-recover</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_sort-recover">sort-recover</a></td>
			<td>强制myisamchk 排序来处理索引即使临时文件将会非常的大</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">stats_method=value</td>
			<td>stats_method</td>
			<td>指明MyISAM 索引统计怎么对待NULL值</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_tmpdir">--tmpdir=path</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_tmpdir">tmpdir</a></td>
			<td>临时文件的存储路径</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_unpack">--unpack</a></td>
			<td><a class="link"
				href="myisamchk-repair-options.html#option_myisamchk_unpack">unpack</a></td>
			<td>解压缩使用myisampack压缩的表</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_update-state">--update-state</a></td>
			<td><a class="link"
				href="myisamchk-check-options.html#option_myisamchk_update-state">update-state</a></td>
			<td>在 .MYI 文件中保存信息，包括何时检查的表，表是否 crash 了</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-general-options.html#option_myisamchk_verbose">--verbose</a></td>
			<td>&nbsp;</td>
			<td>详情模式</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a class="link"
				href="myisamchk-general-options.html#option_myisamchk_version">--version</a></td>
			<td>&nbsp;</td>
			<td>显示版本信息后退出</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">write_buffer_size=#</td>
			<td>write_buffer_size</td>
			<td>写操作的buffer大小</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
	</tbody>
</table>



[4.2.3]:./
[4.3.1]:./
[7.6]:../Chapter_7/
[13.7.2]:../Chapter_13/
[13.7.6]:../Chapter_13/