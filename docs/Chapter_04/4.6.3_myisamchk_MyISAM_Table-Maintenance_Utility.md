### 4.6.3 myisamchk — MyISAM表维护程序

#### 4.6.3.1 [myisamchk 通用选项](#4.6.3.1)
#### 4.6.3.2 [myisamchk Check 选项](#4.6.3.2)
#### 4.6.3.3 [myisamchk Repair 选项](#4.6.3.3)
#### 4.6.3.4 [myisamchk 其它选项](#4.6.3.4)
#### 4.6.3.5 [使用 myisamchk 获取表信息](#4.6.3.5)
#### 4.6.3.6 [myisamchk 内存使用问题](#4.6.3.6)


[myisamchk](#) 程序用来获取数据库表信息，或者是检查、修复、优化数据库表. [myisamchk](#) 用于存储引擎为 MyISAM 类型的表(即具有存储数据的.MYD和存储索引的.MYI的表)。

也可以使用 [CHECK TABLE][13.7.2.2] 和 [REPARE TABLE][13.7.2.5] 语句来检查和修复MyISAM表。 参见 [13.7.2.2, CHECK TABLE 语法][13.7.2.2] 和 [13.7.2.5, REPAIR TABLE 语法][13.7.2.5].

[myisamchk](#) 不支持分区表

>注意:  
>在执行表修复之前最好做表备份，因为在某种条件下，可能造成数据丢失，产生的原因可能是文件系统错误也可能是其它的原因。

[myisamchk](#) 调用如下：

```shell
shell> myisamchk [options] tbl_name ...
```
选项 *options* 指明了想用 [myisamchk](#) 来做什么，本节接下来将详细介绍。可以使用 [myisamchk --help](#) 查看所有的选项。

如果没有指定选项，则 [myisamchk](#) 以默认选项检测表。如果想获取更多的信息或者是让 [mtisamchk](#) 执行纠正操作，则需要指明相应的选项，接下来将具体介绍。

*tbl_name* 是需要检查或者修复的数据库表名称。如果不是在数据所在目录调用 [myisamchk](#) 程序，则需要显示指定数据所在目录，因为 [myisamchk](#) 不知道数据所在的目录。实际上， [myisamchk](#) 并不关心数据所在位置，你可以把表所对应的文件复制到其它目录，然后使用这些文件执行数据恢复操作。

在调用 [myisamchk](#) 的时候，可以指定多个表名，也可以指定索引文件名（以.MYI结尾的文件)代替表名,通过模式 *.MYI 可以指定目录下的所有表。例如，当前目录是数据库数据所在目录，可以检查该目录下所有的 MyISAM 表，命令如下：

```shell
shell> myisamchk *.MYI
```

如果当前目录不是数据所在目录，则需要通过指定路径名来检查所有的表：

```shell
shell> myisamchk /path/to/database_dir/*.MYI
```
甚至可以检查数据库里所有的表，通过指定一个数据路径的通配符：

```shell
shell> myisamchk /path/to/datadir/*/*.MYI
```

推荐的检查所有 MyISAM 表的方式是：

```shell
shell> myisamchk --silent --fast /path/to/datadir/*/*.MYI
```

如果想检查所有的 MyISAM 表并且修复任何出现损坏的，可以使用如下的命令：

```shell
shell> myisamchk --silent --force --fast --update-state \
          --key_buffer_size=64M --myisam_sort_buffer_size=64M \
          --read_buffer_size=1M --write_buffer_size=1M \
          /path/to/datadir/*/*.MYI
```
这个命令假设你有超过64M的内存空间，更多关于 [myisamchk](#) 内存分配的问题，参见 [4.6.3.6 myisamchk 内存使用问题](#4.6.3.6)

更多关于 [myisamchk](#) 的信息，参见 [7.6 MyISAM 表维护和Crash Recovery][7.6]

>**特别注意**  
>当运行 [myisamchk](#) 的时候必须确保没有其它的程序使用该表，最安全的方式是在调用 [myisamchk](#) 的时候关闭掉MySQL服务器或者是对所有 [myisamchk](#) 用到的表加锁。
>否则，当调用 [myisamchk](#) 的时候，可能会显示如下的错误信息
>```
>warning: clients are using or haven't closed the table properly
>```
>这意味着你正在检查一个已经被其它程序更新的表（如 [mysqld][4.3.1] 服务器),但是还没有关闭数据文件或者是程序意外die掉了但没有关闭文件，结果可能会导致一个或多个 MyISAM 表数据损坏。
>如果 [mysqld][4.3.1] 正在运行，则需要执行 [FLUSH TABLES][13.7.6.3] 来强制服务器 flush 任何仍缓存在内存的对表的修改操作，然后需要确保之后没有人再使用这些表当调用 [myisamchk](#) 的时候。
>然而，避免这个问题最简单的方法是使用 [CHECK TABLE][13.7.2.2] 来代替 [myisamchk](#) ,参见 [13.7.2.2 CHECK TABLE 语法][13.7.2.2]


 [myisamchk](#) 支持如下的这些选项，可以在命令行中指定它们或者是在配置文件中以 [myisamchk] 选项组的形式指定。[myisamchk](#) 也支持处理选项文件的选项，参见[4.2.3.4 影响配置文件处理的命令下选项][4.2.3.4]

Table 4.11. myisamchk Options

<table summary="myisamchk Options" border="1">
	<thead>
		<tr>
			<th scope="col">Format</th>
			<th scope="col">Option File</th>
			<th scope="col">Description</th>
			<th scope="col">Introduced</th>
			<th scope="col">Deprecated</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td scope="row">[--analyze][4.6.3.4]</td>
			<td><a ''
				href="">analyze</a></td>
			<td>分析索引值的分布</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_backup">--backup</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_backup">backup</a></td>
			<td>以 file_name-time.BAK 为文件名备份 .MYD 文件</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-other-options.html#option_myisamchk_block-search">--block-search=offset</a></td>
			<td><a href="myisamchk-other-options.html#option_myisamchk_block-search">block-search</a></td>
			<td>在block给定的偏移量找到记录(record)</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_check">--check</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_check">check</a></td>
			<td>检查表是否有错误</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_check-only-changed">--check-only-changed</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_check-only-changed">check-only-changed</a></td>
			<td>仅检查上次检查后发生变更的表</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_correct-checksum">--correct-checksum</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_correct-checksum">correct-checksum</a></td>
			<td>修正表校验和信息</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_data-file-length">--data-file-length=len</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_data-file-length">data-file-length</a></td>
			<td>数据文件的最大长度 (当文件已达到最大长度需要重新创建文件)</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-general-options.html#option_myisamchk_debug">--debug[=debug_options]</a></td>
			<td><a href="myisamchk-general-options.html#option_myisamchk_debug">debug</a></td>
			<td>写debug日志</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">decode_bits=#</td>
			<td>decode_bits</td>
			<td>Decode_bits</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-other-options.html#option_myisamchk_description">--description</a></td>
			<td><a href="myisamchk-other-options.html#option_myisamchk_description">description</a></td>
			<td>输出表的描述信息</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_extend-check">--extend-check</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_extend-check">extend-check</a></td>
			<td>执行表深度检查或修复并根据数据文件尽可能修复每一行</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_fast">--fast</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_fast">fast</a></td>
			<td>仅产检还没有恰当关闭的表</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_force">--force</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_force">force</a></td>
			<td>在表中发现任何错误，自动执行修复操作</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">--force</td>
			<td>force-recover</td>
			<td>重写old临时文件. 需要与 -r or -o 选项一起使用</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">ft_max_word_len=#</td>
			<td>ft_max_word_len</td>
			<td>全文索引的最大分词长度</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">ft_min_word_len=#</td>
			<td>ft_min_word_len</td>
			<td>全文索引最小分词长度</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">ft_stopword_file=value</td>
			<td>ft_stopword_file</td>
			<td>使用这个文件的 stopwords ，不使用内置的 stopwords 列表</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-general-options.html#option_myisamchk_HELP">--HELP</a></td>
			<td>&nbsp;</td>
			<td>显示帮助信息后退出</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-general-options.html#option_myisamchk_help">--help</a></td>
			<td>&nbsp;</td>
			<td>显示帮助信息后退出</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_information">--information</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_information">information</a></td>
			<td>打印被检查表的统计信息</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">key_buffer_size=#</td>
			<td>key_buffer_size</td>
			<td>MyISAM 表索引块的 buffer 的大小</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_keys-used">--keys-used=val</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_keys-used">keys-used</a></td>
			<td>位值表明更新哪个索引</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_max-record-length">--max-record-length=len</a></td>
			<td><a ''
				href="myisamchk-repair-options.html#option_myisamchk_max-record-length">max-record-length</a></td>
			<td>如果record的长度超过了给定的长度使 myisamchk 不能分配足够的内存，则滤过此行跳到下一行</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_medium-check">--medium-check</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_medium-check">medium-check</a></td>
			<td>比 --extend-check check更快的一个检查表操作</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">myisam_block_size=#</td>
			<td>myisam_block_size</td>
			<td>索引页的block大小</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">myisam_sort_buffer_size=#</td>
			<td>myisam_sort_buffer_size</td>
			<td>buffer的大小，当执行REPAIR操作排序索引或者使用 CREATE INDEX 或 ALTER TABLE 创建索引</td>
			<td>5.6.9</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_parallel-recover">--parallel-recover</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_parallel-recover">parallel-recover</a></td>
			<td>Uses the same technique as -r and -n, but creates all the
				keys in parallel, using different threads (beta)</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_quick">--quick</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_quick">quick</a></td>
			<td>Achieve a faster repair by not modifying the data file.</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">read_buffer_size=#</td>
			<td>read_buffer_size</td>
			<td>Each thread that does a sequential scan allocates a buffer
				of this size for each table it scans</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_read-only">--read-only</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_read-only">read-only</a></td>
			<td>Don't mark the table as checked</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_recover">--recover</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_recover">recover</a></td>
			<td>Do a repair that can fix almost any problem except unique
				keys that aren't unique</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_safe-recover">--safe-recover</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_safe-recover">safe-recover</a></td>
			<td>Do a repair using an old recovery method that reads through
				all rows in order and updates all index trees based on the rows
				found</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-other-options.html#option_myisamchk_set-auto-increment">--set-auto-increment[=value]</a></td>
			<td><a href="myisamchk-other-options.html#option_myisamchk_set-auto-increment">set-auto-increment</a></td>
			<td>Force AUTO_INCREMENT numbering for new records to start at
				the given value</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_set-collation">--set-collation=name</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_set-collation">set-collation</a></td>
			<td>Specify the collation to use for sorting table indexes</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-general-options.html#option_myisamchk_silent">--silent</a></td>
			<td><a href="myisamchk-general-options.html#option_myisamchk_silent">silent</a></td>
			<td>Silent mode</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">sort_buffer_size=#</td>
			<td>sort_buffer_size</td>
			<td>The buffer that is allocated when sorting the index when
				doing a REPAIR or when creating indexes with CREATE INDEX or ALTER
				TABLE</td>
			<td>&nbsp;</td>
			<td>5.6.9</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-other-options.html#option_myisamchk_sort-index">--sort-index</a></td>
			<td><a href="myisamchk-other-options.html#option_myisamchk_sort-index">sort-index</a></td>
			<td>Sort the index tree blocks in high-low order</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">sort_key_blocks=#</td>
			<td>sort_key_blocks</td>
			<td>sort_key_blocks</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-other-options.html#option_myisamchk_sort-records">--sort-records=#</a></td>
			<td><a href="myisamchk-other-options.html#option_myisamchk_sort-records">sort-records</a></td>
			<td>根据索引排序</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_sort-recover">--sort-recover</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_sort-recover">sort-recover</a></td>
			<td>强制myisamchk 排序来处理索引即使临时文件将会非常的大</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">stats_method=value</td>
			<td>stats_method</td>
			<td>指明MyISAM 索引统计怎么对待NULL值</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_tmpdir">--tmpdir=path</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_tmpdir">tmpdir</a></td>
			<td>临时文件的存储路径</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-repair-options.html#option_myisamchk_unpack">--unpack</a></td>
			<td><a href="myisamchk-repair-options.html#option_myisamchk_unpack">unpack</a></td>
			<td>解压缩使用myisampack压缩的表</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-check-options.html#option_myisamchk_update-state">--update-state</a></td>
			<td><a href="myisamchk-check-options.html#option_myisamchk_update-state">update-state</a></td>
			<td>在 .MYI 文件中保存信息，包括何时检查的表，表是否 crash 了</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-general-options.html#option_myisamchk_verbose">--verbose</a></td>
			<td>&nbsp;</td>
			<td>详情模式</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row"><a href="myisamchk-general-options.html#option_myisamchk_version">--version</a></td>
			<td>&nbsp;</td>
			<td>显示版本信息后退出</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td scope="row">write_buffer_size=#</td>
			<td>write_buffer_size</td>
			<td>写操作的buffer大小</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
	</tbody>
</table>


<h4 id="4.6.3.1">4.6.3.1  myisamchk 通用选项</h4>

本节将要介绍的选项可以被 [myisamchk](#) 任何表维护操作使用，本节后的那几节介绍的选项就专属于特定的操作，如表检查或表修复。

* help, -?

    显示帮助信息，选项根据操作类型分组显示

* HELP, -H

	显示帮助信息,选项以一个列表形式显示

* --debug=debug\_options, -# debug\_options

	写debug日志，典型的 *debug\_options* 是 'd:t:o,file\_name', 默认的是 'd:t:o,/tmp/myisamchk.trace'

* --silient, -s

	静音模式(silient)，自在有错误出现的时候有输出，可以使用2个-s 使 [myisamchk](#) 非常 silient

* --verbose, -v

	详情模式，输出更多程序执行信息，可以与 -d 和 -e 一起使用，使用多个-v(-vv,-vvv)输出更多的内容。

* --version, -V

	显示版本信息

* --wait, -w

	如果表锁了，则等待解锁后继续执行而不是显示错误信息后结束程序。如果 [mysqld][4.3.1] 启动的时候没有开启外部锁定选项，则表只能是被另一个 [myisamchk](#) 程序加锁了。

通过语法 `--var_name=value` 可以指定下面各变量的值

<table border="0">
	<thead>
		<tr>
			<th scope="col">Variable</th>
			<th scope="col">Default Value</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td scope="row"><code>decode_bits</code></td>
			<td>9</td>
		</tr>
		<tr>
			<td scope="row"><code>ft_max_word_len</code></td>
			<td>version-dependent</td>
		</tr>
		<tr>
			<td scope="row"><code>ft_min_word_len</code></td>
			<td>4</td>
		</tr>
		<tr>
			<td scope="row"><code>ft_stopword_file</code></td>
			<td>built-in list</td>
		</tr>
		<tr>
			<td scope="row"><code>key_buffer_size</code></td>
			<td>523264</td>
		</tr>
		<tr>
			<td scope="row"><code>myisam_block_size</code></td>
			<td>1024</td>
		</tr>
		<tr>
			<td scope="row"><code>myisam_sort_key_blocks</code></td>
			<td>16</td>
		</tr>
		<tr>
			<td scope="row"><code>read_buffer_size</code></td>
			<td>262136</td>
		</tr>
		<tr>
			<td scope="row"><code>sort_buffer_size</code></td>
			<td>2097144</td>
		</tr>
		<tr>
			<td scope="row"><code>sort_key_blocks</code></td>
			<td>16</td>
		</tr>
		<tr>
			<td scope="row"><code>stats_method</code></td>
			<td>nulls_unequal</td>
		</tr>
		<tr>
			<td scope="row"><code>write_buffer_size</code></td>
			<td>262136</td>
		</tr>
	</tbody>
</table>

使用 [myisamchk --help](#) 可以查看 [myisamchk](#) 支持的变量及默认值。

`sort_buffer_size` 在通过索引排序来修复索引的时候用到，它也是在执行 `--recover` 操作时经常遇到的。从MySQL 5.6.9 开始，`myisam_sort_buffer_size` 可以作为 `sort_buffer_size` 的替代品了，`myisam_sort_buffer_size` 比 `sort_buffer_size` 更适合，因为后天与 `myisam_sort_buffer_size` 相比与系统变量有相似的意思，`sort_buffer_size` 应当考试废弃了。

`key_buffer_size ` 被使用当检查表的时候指定选项 `--extend-check` 或者是在修复索引的时候通过一行行的插入索引到表（想普通的insert一样)。在如下两种情况下，修复的时候会用到 key buffer ：

* 使用--safe-recover选项
* 排序索引所用到的临时文件比直接创建索引的文件大2倍。如果在[CHAR][11.4.1]，[VARCHAR][11.4.1] 或者 [TEXT][11.4.3] 类型上有比较大的索引，则经常发生这种情况，因为当排序的时候需要保持完整的索引值。如果有比充较充裕的临时空间，则可以通过选项 ` --sort-recover ` 来强制 [myisamchk](#) 通过排序来修复表。

通过 key buffer 修复表比使用索引排序修复表使用更少的硬盘空间，但是也相对比较慢。

`myisam_block_size` 是索引块的大小

`stats_method` 影响 `NULL` 值的处理当指定选项 `--analyze` 进行索引信息统计的时候。它像系统变量 `myisam_stats_method` 一样。更多信息，参见关于 `myisam_stats_method` 的介绍 [5.1.4 系统变量][5.1.4] 和 [8.3.7 InnoDB 和 MyISAM 索引信息收集][8.3.7]

`ft_min_word_len` 和 `ft_max_word_len` 指明了MyISAM表全文索引最小和最大分词长度。`ft_stopword_file` 指定了 stopwords 文件,这些值需要下如下环境下设置。

如果使用 [myisamchk](#) 执行更改表索引的操作（如repair 和 analyze),则重新创建全文索引，如果不指定参数的话，则使用服务器默认的最大最小分词长度和stopwords。这可能导致查询失败。

问题出现的原因是只有服务器知道参数的值，它们没有保存在 MyISAM 索引文件里，如果更改了服务器的最大最小分词长度或者stopwords，则为了避免出现问题，需要给 [myisamchk](#) 指定与 [mysqld][4.3.1] 相同的 `ft_min_word_len`, `ft_max_word_len`, 和 `ft_stopword_file ` 。例如，已经设置了最小词长是3，则可以像如下这样使用 [myisamchk](#) 修复表：

```shell
shell> myisamchk --recover --ft_min_word_len=3 tbl_name.MYI
```
为了确保 [myisamchk](#) 和服务器使用相同的全文索引参数，可以在配置文件中指定 [myisamchk] 和 [mysqld] 的值：

```shell
[mysqld]
ft_min_word_len=3

[myisamchk]
ft_min_word_len=3
```

与 [myisamchk](#) 功能类似的是 [REPAIR TABLE][13.7.2.5], [ANALYZE TABLE][13.7.2.1], [OPTIMIZE TABLE][13.7.2.4], or [ALTER TABLE][13.1.7]


<h4 id="4.6.3.2">4.6.3.2 myisamchk Check 选项</h4>

[myisamchk](#) 表检查操作支持如下这些选项：

* --check, -c

	检查表是否有错误，如果没有指定操作类型的话这是默认的操作

* --check-only-changed, -C

	只检查上次检查后发生变更的表

* --extend-check, -e

	深度检查表，如果表的索引非常的话会很慢，该选项只在特殊的情况下会使用，通常情况下，[myisamchk](#) 或者 [myisamchk --medium-check](#) 就可以检查出表是否有错误

	如果使用--extend-check并且有足够的内存，则把 `key_buffer_size` 设置成一个比较大的值可以提高修复操作的执行速度

	更多关于输出格式的描述，参见[4.6.3.5 使用 myisamchk 获取表信息](#4.6.3.5)

* --fast, -F

	仅检查没有正确关闭掉的表

* --force, -f

	如果 [myisamchk](#) 发现错误的话则自动执行修复操作，修复类型同指定选项 --recover 或 -r操作一样

* --information, -i

	输出检查表的统计信息

* --medium-check, -m

	执行比--extend-check 更快的表检查操作，会发现99.99%的错误，在大部分情况下，已经很好了

* --read-only -T

	

* --update-status , -U

	在 .MYI 文件中保存信息，表是否已检查，表是否crash，
	






[4.2.3.4]:./#4.2.3.4
[4.3.1]:./
[5.1.4]:./
[7.6]:../Chapter_7/
[8.3.7]:../
[11.4.1]:../Chapter_11/
[11.4.3]:../Chapter_11/
[13.1.7]:../Chapter_13/
[13.7.2.1]:../Chapter_13/#13.7.2.1
[13.7.2.2]:../Chapter_13/#13.7.2.2
[13.7.2.4]:../Chapter_13/#13.7.2.4
[13.7.2.5]:../Chapter_13/#13.7.2.5
[13.7.6.3]:../Chapter_13/#13.7.6.3