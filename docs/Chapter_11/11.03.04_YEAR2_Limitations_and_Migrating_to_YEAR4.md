## 11.3.4 YEAR(2)的局限性和转换至YEAR(4)

虽然YEAR(4)和YEAR(2)的内部范围值是相同的（1901到2155和0000），但YEAR(2)的显示宽度使得该类型模棱两可，因为显示的值表示只有最后两位数的内置值。在某些情况下，结果可能会有丢失。为此，考虑避免YEAR(2)出现在整个应用程序和无论何时需要使用YEAR类型时使用YEAR(4)。本节介绍了使用YEAR(2)时可以产生和提供现有YEAR(2)迁移至YEAR(4)的有关信息。请注意，在某些时候迁移是必要的，因为支持含有4以外的显示值的YEAR类型，最特别的YEAR(2)，从MySQL5.6.6开始减少并在未来的版本中完全移除。

**YEAR(2)的局限性**

YEAR(2)类型具有包括显示值的歧义的问题，并在导出导入数据或转换到字符串时可能丢失信息。

* 显示的YEAR(2)的值是不明确的。最多可能有三种YEAR(2)值，它们显示相同的值却具有不同的内置值，如下面的示例：

    ```
    mysql> CREATE TABLE t (y2 YEAR(2), y4 YEAR(4));
    Query OK, 0 rows affected (0.01 sec)
    
    mysql> INSERT INTO t (y2) VALUES(1912),(2012),(2112);
    Query OK, 3 rows affected (0.00 sec)
    Records: 3 Duplicates: 0 Warnings: 0
    
    mysql> UPDATE t SET y4 = y2;
    Query OK, 3 rows affected (0.00 sec)
    Rows matched: 3 Changed: 3 Warnings: 0
    
    mysql> SELECT * FROM t;
    +------+------+
    | y2 | y4 |
    +------+------+
    | 12 | 1912 |
    | 12 | 2012 |
    | 12 | 2112 |
    +------+------+
    3 rows in set (0.00 sec)
    ```

* 如果使用mysqldump导出前面示例创建的表，导出文件中y2的所有值均使用2位表示法表示为（12）。如果使用导出文件重新导入，所有结果行均是2012的内置值并显示为12，从而失去了它们之间的区别。

* 转换YEAR(2)或YEAR(4)到字符串的格式，使用YEAR类型的显示宽度。假设YEAR(2)和YEAR(4)列都含有1970。每个列指定一个字符串结果分别是'70'或'1970'。就是说，在YEAR(2)转换到字符串时出现了信息丢失。

* 当插入一个在1970到2069范围以外的值到CVS表的YEAR(2)列时会存储错误。例如，插入2111，结果显示值是11，但内置却值是2011。

为了避免这些问题，使用YEAR(4)而不是YEAR(2)。本节后面将阐述有关迁移策略的建议。

**MySQL5.6减少了对YEAR(2)的支持**

从MySQL5.6.6开始，减少了对YEAR(2)的支持：

* 在新建表中定义的YEAR(2)会被转换为YEAR(4)：

    ```
    mysql> CREATE TABLE t1 (y YEAR(2));
    Query OK, 0 rows affected, 1 warning (0.03 sec)
    
    mysql> SHOW WARNINGS\G
    *************************** 1. row ***************************
    Level: Warning
    Code: 1818
    Message: YEAR(2) column type is deprecated. Creating YEAR(4) column instead.
    1 row in set (0.00 sec)
    
    mysql> SHOW CREATE TABLE t1\G
    *************************** 1. row ***************************
    Table: t1
    Create Table: CREATE TABLE \`t1\` (
    \`y\` year(4) DEFAULT NULL
    ) ENGINE=InnoDB DEFAULT CHARSET=latin1
    1 row in set (0.00 sec)
    ```

* 在现有表中的YEAR(2)还是YEAR(2)并在MySQL的旧版本中执行查询处理。但是，一些程序或语句会自动将YEAR(2)转换为YEAR(4)：

    * ALTER TABLE语句使得表重建。

    * REPAIR TABLE（如果发现表中含有YEAR(2)列推荐使用CHECK TABLE）。

    * mysql\_upgrade（其使用REPAIR TABLE）。

    * 使用mysqldump导出并使用导出文件重新导入。前三项进行不同的转换，导出和重新导入很可能改变值的内容。

MySQL升级通常至少涉及到最后两项中的一项。但是，对于YEAR(2)，你应该避免导出和重新导入；如上所述，它会改变值的内容。

**YEAR(2)迁移至YEAR(4)**

如果你决定将YEAR(2)列转换为YEAR(4)，