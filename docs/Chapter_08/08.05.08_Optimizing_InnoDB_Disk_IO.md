### 8.5.8 Optimizing InnoDB Disk I/O

如果你遵循了数据库设计和SQL调优相关的优化原则，但是你的数据库仍然受限于高负荷的磁盘I/O压力，那就看下下面的关于磁盘I/O相关的技术吧。如果Unix的top工具或者Windows的任务管理器显示你的CPU使用率在70%一下，那么你的负载可能是磁盘密集型的。

* 当表的数据被缓存在InnoDB buffer pool的时候，访问他不需要任何磁盘I/O。通过设置innodb_buffer_pool_size参数来指定buffer pool的大小。建议将innodb_buffer_pool_size配置在系统内存的50%-75%之间。更多信息参见[Section 8.12.4.1, “How MySQL Uses Memory”](TODO)。

* 在某些GUN/Linux的发行版，或则Unix的发行版之中，调用Unix fsync()接口（InnoDB默认使用）或者类似的方法，简直慢成狗。如果数据库的写性能确实是个问题的话，修改innodb_flush_method参数为O_DSYNC并测试。

* 在Solaris 10的x86_64架构下（AMD Opteron），对InnoDB相关的文件采用direct I/O的方式可以避免性能的恶化。对一个完整的UFS文件系统使用derict I/O，挂载的时候需要参数forcedirectio；参考mount_ufs。
When using the InnoDB storage engine on Solaris 10 for x86_64 architecture (AMD Opteron), use direct I/O for InnoDB-related files, to avoid degradation of InnoDB performance. To use direct I/O for an entire UFS file system used for storing InnoDB-related files, mount it with the forcedirectio option; see mount_ufs(1M). (The default on Solaris 10/x86_64 is not to use this option.) To apply direct I/O only to InnoDB file operations rather than the whole file system, set innodb_flush_method = O_DIRECT. With this setting, InnoDB calls directio() instead of fcntl() for I/O to data files (not for I/O to log files).

When using the InnoDB storage engine with a large innodb_buffer_pool_size value on any release of Solaris 2.6 and up and any platform (sparc/x86/x64/amd64), conduct benchmarks with InnoDB data files and log files on raw devices or on a separate direct I/O UFS file system, using the forcedirectio mount option as described earlier. (It is necessary to use the mount option rather than setting innodb_flush_method if you want direct I/O for the log files.) Users of the Veritas file system VxFS should use the convosync=direct mount option.

Do not place other MySQL data files, such as those for MyISAM tables, on a direct I/O file system. Executables or libraries must not be placed on a direct I/O file system.

If you have additional storage devices available to set up a RAID configuration or symbolic links to different disks, Section 8.12.2, “Optimizing Disk I/O” for additional low-level I/O tips.

If throughput drops periodically because of InnoDB checkpoint operations, consider increasing the value of the innodb_io_capacity configuration option. Higher values cause more frequent flushing, avoiding the backlog of work that can cause dips in throughput.

